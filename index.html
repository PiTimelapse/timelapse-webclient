<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"></meta>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
        <title>Timelapse Web Client</title>
        <script src="bower_components/platform/platform.js"></script>
        <link rel="import" href="bower_components/font-roboto/roboto.html">
        <link rel="import" href="bower_components/paper-button/paper-button.html">
        <link rel="import" href="bower_components/paper-item/paper-item.html">
        <link rel="import" href="bower_components/paper-toast/paper-toast.html">
        <link rel="import" href="bower_components/paper-tabs/paper-tabs.html">
        <link rel="import" href="bower_components/paper-input/paper-input.html">
        <link rel="import" href="components/slider-box.html">
        <link rel="stylesheet" href="css/style.css">
        <style>

            html, body {
                height: 100%;
                margin: 0;
                background-color: #E5E5E5;
                font-family: 'RobotoDraft', sans-serif;
                font-weight: 300;
            }

        </style>
        <script>
            // Extends the mapping for ng-polymer-elements, will disapear when polymer will work properly with angular
            if (!window.NG_POLYMER_ELEMENTS_EXTENDED_MAPPINGS) {
                window.NG_POLYMER_ELEMENTS_EXTENDED_MAPPINGS = {};
            }
            window.NG_POLYMER_ELEMENTS_EXTENDED_MAPPINGS.paperTabs = {
                ngChange: {
                    event: "manual-change"
                },
                ngModel: {
                    primitive: "selected"
                }
            };
        </script>
    </head>
    <body unresolved touch-action="auto" ng-app="tl-app">
            <div class="content" flex layout horizontal ng-controller="MainController">
                <div class="sidebar">
                    <p ng-hide="cameras.length">No camera detected</p>
                    <paper-item class="camera" ng-repeat="camera in cameras" ng-class="{'selected': $index === selectedCamera}" ng-click="selectCamera($index)">
                        {{camera.model}}
                    </paper-item>
                </div>
                <div flex ng-show="selectedCamera !== null">
                    <paper-tabs ng-model="tab">
                        <paper-tab>Settings</paper-tab>
                        <paper-tab>Timelapse</paper-tab>
                        <paper-tab>Advanced</paper-tab>
                    </paper-tabs>
                    <div class="mainBoard" ng-show="tab === 0" layout vertical>
                        <slider-box ng-repeat="(key,prop) in props"
                                    values="{{prop.choices}}"
                                    title="{{prop.label}}"
                                    ng-model="prop.value"
                                    ng-change="propertyChange('{{key}}')" ng-if="prop.type === 'choice'"></slider-box>
                        <div class="preview" flex layout vertical>
                            <img src="public{{preview}}" alt="preview" ng-show="preview !== ''">
                            <span ng-show="brightness !== ''">Mean brightness: {{brightness}}</span>
                        </div>
                        <paper-button label="Preview" raisedButton ng-click="takePicture()"></paper-button>
                    </div>
                    <div class="mainBoard" ng-show="tab === 1" layout vertical>
                        <paper-input type="number" ng-model="tlDelay" min="1"></paper-input>
                        <div layout horizontal>
                            <paper-button label="Start timelapse" raisedButton ng-click="startTimelapse()"></paper-button>
                            <paper-button label="Stop timelapse" raisedButton ng-click="stopTimelapse()"></paper-button>
                        </div>
                    </div>
                    <div class="mainBoard" ng-show="tab === 2" layout vertical>
                        <paper-input type="number" floatingLabel label="Minimum brightness" ng-model="conf.MIN_BRIGHTNESS"></paper-input>
                        <paper-input type="number" floatingLabel label="Maximum brightness" ng-model="conf.MAX_BRIGHTNESS"></paper-input>
                        <paper-button label="Save" raisedButton ng-click="updateConf()"></paper-button>
                    </div>
                </div>
                <div flex layout horizontal center-justified ng-show="selectedCamera === null">
                    <p self-center>Choose a camera to start</p>
                </div>
                <paper-toast id="toast" duration="5000" text="{{notification.message}}"></paper-toast>
            </div>
        <script src="http://localhost:3000/socket.io/socket.io.js"></script>
        <script src="bower_components/angular/angular.min.js"></script>
        <script src="bower_components/ng-polymer-elements/ng-polymer-elements.min.js"></script>
        <script src="js/angular/modules.js"></script>
        <script src="js/angular/controllers/mainCtrl.js"></script>
        <script src="js/angular/services/socket.js"></script>
        <script src="js/angular/app.js"></script>
    </body>
</html>
